<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Exercises · Davai</title><meta name="title" content="Exercises · Davai"/><meta property="og:title" content="Exercises · Davai"/><meta property="twitter:title" content="Exercises · Davai"/><meta name="description" content="Documentation for Davai."/><meta property="og:description" content="Documentation for Davai."/><meta property="twitter:description" content="Documentation for Davai."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.jpg" alt="Davai logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Davai</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../create_branch/">Creating a branch</a></li><li><a class="tocitem" href="../runtests/">Running tests</a></li><li><a class="tocitem" href="../ciboulai/">Monitoring results</a></li><li><a class="tocitem" href="../ciboulai_navigation/">Ciboulaï navigation</a></li></ul></li><li><span class="tocitem">More info</span><ul><li><a class="tocitem" href="../organization/">Organization of experiment</a></li><li><a class="tocitem" href="../jobs_tasks/">Jobs &amp; Tasks</a></li><li><a class="tocitem" href="../mtool/">MTOOL</a></li><li><a class="tocitem" href="../tips/">First tips</a></li></ul></li><li><span class="tocitem">Advanced topics</span><ul><li><a class="tocitem" href="../build/">Build</a></li><li><a class="tocitem" href="../rerun/">Rerun tests</a></li><li><a class="tocitem" href="../investigatingproblems/">Investigate Problems</a></li><li><a class="tocitem" href="../buildoptions/">Build options</a></li><li><a class="tocitem" href="../inputdata/">Input data</a></li><li><a class="tocitem" href="../otheroptions/">Other options</a></li><li><a class="tocitem" href="../userconfiguration/">User configuration</a></li><li><a class="tocitem" href="../parallelprofiling/">Parallel profiling</a></li><li><a class="tocitem" href="../expertthresholds/">Expert thresholds</a></li></ul></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../uget/uget/">uget</a></li><li class="is-active"><a class="tocitem" href>Exercises</a></li></ul></li><li><span class="tocitem">Appendix</span><ul><li><a class="tocitem" href="../versioningtest/">Versioning tests</a></li><li><a class="tocitem" href="../continuousintegration/">Continuous integration</a></li><li><a class="tocitem" href="../setting_reference/">Setting reference exp</a></li><li><a class="tocitem" href="../internalorganization/">Internal organization</a></li></ul></li><li><span class="tocitem">HPC Platforms</span><ul><li><a class="tocitem" href="../belenos/">Belenos</a></li><li><a class="tocitem" href="../atos_bologna/">Atos</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer documentation</a></li><li class="is-active"><a href>Exercises</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Exercises</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ACCORD-NWP/DAVAI-env" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ACCORD-NWP/DAVAI-env/blob/master/docs/src/exercise4developers.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h3 id="Adding-an-ALAROSURFEX-test-to-DAVAÏ"><a class="docs-heading-anchor" href="#Adding-an-ALAROSURFEX-test-to-DAVAÏ">Adding an ALARO+SURFEX test to DAVAÏ</a><a id="Adding-an-ALAROSURFEX-test-to-DAVAÏ-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-an-ALAROSURFEX-test-to-DAVAÏ" title="Permalink"></a></h3><p>This section describes what was done to add an ALARO+SURFEX test to DAVAÏ. It may serve as a recipe to add other tests.</p><p>First, create a new DAVAÏ experiment with <code>davai-new_xp</code>. Also, run following commands to set the environment:</p><pre><code class="language-bash hljs">source ~acrd/.vortexrc/profile
cp ~rm9/.vortexrc/uget-client-defaults.ini .vortexrc/</code></pre><p>Next, initialize the hack directory for your user:</p><pre><code class="language-bash hljs">uget.py bootstrap_hack ${USER}</code></pre><p>Note: directories in this document are usually relative to the experiment&#39;s base directory.</p><h4 id="Creating-the-test-itself"><a class="docs-heading-anchor" href="#Creating-the-test-itself">Creating the test itself</a><a id="Creating-the-test-itself-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-the-test-itself" title="Permalink"></a></h4><h5 id="Modifications-to-the-file-conf/davai_nrv.ini:"><a class="docs-heading-anchor" href="#Modifications-to-the-file-conf/davai_nrv.ini:">Modifications to the file <code>conf/davai_nrv.ini</code>:</a><a id="Modifications-to-the-file-conf/davai_nrv.ini:-1"></a><a class="docs-heading-anchor-permalink" href="#Modifications-to-the-file-conf/davai_nrv.ini:" title="Permalink"></a></h5><ul><li><p>add a section for the model:</p><pre><code class="language-ini hljs">[alaro]
model               = alaro
LAM                 = True
input_shelf         = &amp;{input_shelf_lam}
fcst_term           = 12
expertise_term      = 12
coupling_frequency  = 3</code></pre></li><li><p>add a section for the forecast itself:</p><pre><code class="language-ini hljs">[forecast-alaro1_sfx-chmh2325]
alaro_version       = 1_sfx
rundate             = date(2021022000)</code></pre></li><li><p>since we&#39;re using a new domain (chmh2325), add a section for this domain:</p><pre><code class="language-ini hljs">[chmh2325]
geometry            = geometry(chmh2325)
timestep            = 90</code></pre></li></ul><h5 id="Modifications-to-the-file-tasks/forecasts/standalone_forecasts.py:"><a class="docs-heading-anchor" href="#Modifications-to-the-file-tasks/forecasts/standalone_forecasts.py:">Modifications to the file <code>tasks/forecasts/standalone_forecasts.py</code>:</a><a id="Modifications-to-the-file-tasks/forecasts/standalone_forecasts.py:-1"></a><a class="docs-heading-anchor-permalink" href="#Modifications-to-the-file-tasks/forecasts/standalone_forecasts.py:" title="Permalink"></a></h5><p>The easiest is to copy and modify an existing forecast. In this case, we added to the following to the <code>alaro</code> family:</p><pre><code class="language-python hljs">                    Family(tag=&#39;chmh2325&#39;, ticket=t, nodes=[
                          StandaloneAlaroForecast(tag=&#39;forecast-alaro1_sfx-chmh2325&#39;, ticket=t, **kw),
                    , **kw),</code></pre><h5 id="Modifications-to-the-file-tasks/forecasts/standalone/alaro.py:"><a class="docs-heading-anchor" href="#Modifications-to-the-file-tasks/forecasts/standalone/alaro.py:">Modifications to the file <code>tasks/forecasts/standalone/alaro.py</code>:</a><a id="Modifications-to-the-file-tasks/forecasts/standalone/alaro.py:-1"></a><a class="docs-heading-anchor-permalink" href="#Modifications-to-the-file-tasks/forecasts/standalone/alaro.py:" title="Permalink"></a></h5><p>We need to add the fetching of the SURFEX initial file, the SURFEX namelist and the PGD file. This was done using the AROME forecast task as an example. The fetching of these files is put under a condition <code>self.conf.alaro_version == &#39;1_sfx&#39;</code>, to make sure the files are only fetched when running ALARO with SURFEX.</p><h4 id="Setup-a-custom-catalogue"><a class="docs-heading-anchor" href="#Setup-a-custom-catalogue">Setup a custom catalogue</a><a id="Setup-a-custom-catalogue-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-a-custom-catalogue" title="Permalink"></a></h4><p>Find out which catalogue is used by your test. In the case of ALARO, the file <code>alaro.py</code> uses <code>self.conf.davaienv</code>, which is set in <code>davai_nrv.ini</code> to be <code>cy49.davai_specials.02@davai</code>. A local copy of this catalogue is created with</p><pre><code class="nohighlight hljs">uget.py hack env cy49.davai_specials.02@davai into cy49.davai_specials.02@@${USER}</code></pre><p>This will create a local catalogue file under <code>~/.vortexrc/hack/uget/${USER}/env/</code>. Make sure to modify the value in <code>davai_nrv.ini</code> to use your local copy.</p><h4 id="Adding-constant-files-such-as-namelist-files,-PGD-file,-etc."><a class="docs-heading-anchor" href="#Adding-constant-files-such-as-namelist-files,-PGD-file,-etc.">Adding constant files such as namelist files, PGD file, etc.</a><a id="Adding-constant-files-such-as-namelist-files,-PGD-file,-etc.-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-constant-files-such-as-namelist-files,-PGD-file,-etc." title="Permalink"></a></h4><p>Constant files go into the <code>~/.vortexrc/hack/</code> directory. To add/modify a namelist file, first find out which namelists are used by your test in the local catalogue file you copied before (<code>cy49.davai_specials.02@${USER}</code>). In the case of the ALARO forecast, the namelists that are used are <code>49.arpifs@davai.02.nam.tgz@davai</code>, so a local copy is taken of these with</p><pre><code class="nohighlight hljs">uget.py hack data 49.arpifs@davai.02.nam.tgz@davai into 49.arpifs@davai.02.nam.tgz@${USER}</code></pre><p>This creates a tgz file under <code>~/.vortexrc/hack/uget/${USER}/data/</code>, which then needs to be unpacked. Make sure to modify the catalogue file to use your local copy of the namelists.</p><p>You then can modify existing namelist files, or - as was the case for the ALARO+SURFEX test - add new namelist files. The location and name of the required namelists can be found in the forecast script (<code>alaro.py</code>). The namelists created were <code>model/alaro/fcst.alaro1_sfx.nam</code> and <code>model/alaro/fcst.alaro1_sfx.nam_surfex</code>. Make sure to use the following variables/values:</p><pre><code class="nohighlight hljs">CNMEXP=__CEXP__,
NPROC=__NBPROC__,
NSTRIN=__NBPROC__,
NSTROUT=__NBPROC__,
CSTOP=__FCSTOP__,
TSTEP=__TIMESTEP__,</code></pre><p>since these are substituted by DAVAÏ.</p><p>The name of the PGD file needs to be set in the catalogue <code>cy49.davai_specials.02@${USER}</code> by adding the line</p><pre><code class="nohighlight hljs">PGD_FA_CHMH2325=uget:pgd.chmh2325-02km33.fa.01@${USER}</code></pre><p>The PGD file itself should be put just under <code>~/.vortexrc/hack/uget/${USER}/data/</code>.</p><h4 id="Setting-non-constant-files-such-as-initial-conditions,-LBC-files,-etc."><a class="docs-heading-anchor" href="#Setting-non-constant-files-such-as-initial-conditions,-LBC-files,-etc.">Setting non-constant files such as initial conditions, LBC files, etc.</a><a id="Setting-non-constant-files-such-as-initial-conditions,-LBC-files,-etc.-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-non-constant-files-such-as-initial-conditions,-LBC-files,-etc." title="Permalink"></a></h4><p>These files should go into the shelf (since in mixed tests they could be generated by an earlier task). The name of the shelf can be found in <code>davai_nrv.ini</code>, and turns out to be <code>input_shelf_LAM = shelf_cy48t1_LAM.01@davai</code>, so we&#39;ll create a directory <code>/scratch/${USER}/mtool/cache/vortex/davai/shelves/shelf_cy48t1_LAM.01@davai/</code>. Following files are put in this directory:</p><pre><code class="nohighlight hljs">20210220T0000A/surfan/analysis.surf-surfex.chmh2325-02km33.fa
20210220T0000A/coupling/cpl.arpege-4dvarfr-prod.chmh2325-02km33+0003:00.fa
20210220T0000A/coupling/cpl.arpege-4dvarfr-prod.chmh2325-02km33+0009:00.fa
20210220T0000A/coupling/cpl.arpege-4dvarfr-prod.chmh2325-02km33+0000:00.fa
20210220T0000A/coupling/cpl.arpege-4dvarfr-prod.chmh2325-02km33+0006:00.fa
20210220T0000A/coupling/cpl.arpege-4dvarfr-prod.chmh2325-02km33+0012:00.fa</code></pre><p>To know how to name these files, look at similar data for other experiments, or just your experiment and see where it crashes.</p><h3 id="Defining-a-new-geometry"><a class="docs-heading-anchor" href="#Defining-a-new-geometry">Defining a new geometry</a><a id="Defining-a-new-geometry-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-new-geometry" title="Permalink"></a></h3><p>Since the ALARO+SURFEX test runs on a new domain, this domain should also be registred. This is done in a file <code>~/.vortexrc/geometries.ini</code>, following the examples from the file <code>vortex/conf/geometries.ini</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../uget/uget/">« uget</a><a class="docs-footer-nextpage" href="../versioningtest/">Versioning tests »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Wednesday 16 October 2024 08:16">Wednesday 16 October 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
