<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Versioning tests · Davai</title><meta name="title" content="Versioning tests · Davai"/><meta property="og:title" content="Versioning tests · Davai"/><meta property="twitter:title" content="Versioning tests · Davai"/><meta name="description" content="Documentation for Davai."/><meta property="og:description" content="Documentation for Davai."/><meta property="twitter:description" content="Documentation for Davai."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.jpg" alt="Davai logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Davai</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../create_branch/">Creating a branch</a></li><li><a class="tocitem" href="../runtests/">Running tests</a></li><li><a class="tocitem" href="../ciboulai/">Monitoring results</a></li><li><a class="tocitem" href="../ciboulai_navigation/">Ciboulaï navigation</a></li></ul></li><li><span class="tocitem">More info</span><ul><li><a class="tocitem" href="../organization/">Organization of experiment</a></li><li><a class="tocitem" href="../jobs_tasks/">Jobs &amp; Tasks</a></li><li><a class="tocitem" href="../mtool/">MTOOL</a></li><li><a class="tocitem" href="../tips/">First tips</a></li></ul></li><li><span class="tocitem">Advanced topics</span><ul><li><a class="tocitem" href="../build/">Build</a></li><li><a class="tocitem" href="../rerun/">Rerun tests</a></li><li><a class="tocitem" href="../investigatingproblems/">Investigate Problems</a></li><li><a class="tocitem" href="../buildoptions/">Build options</a></li><li><a class="tocitem" href="../inputdata/">Input data</a></li><li><a class="tocitem" href="../otheroptions/">Other options</a></li><li><a class="tocitem" href="../userconfiguration/">User configuration</a></li><li><a class="tocitem" href="../parallelprofiling/">Parallel profiling</a></li><li><a class="tocitem" href="../expertthresholds/">Expert thresholds</a></li></ul></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../uget/uget/">uget</a></li><li><a class="tocitem" href="../exercise4developers/">Exercises</a></li></ul></li><li><span class="tocitem">Appendix</span><ul><li class="is-active"><a class="tocitem" href>Versioning tests</a><ul class="internal"><li><a class="tocitem" href="#Versioning-of-tests"><span>Versioning of tests</span></a></li></ul></li><li><a class="tocitem" href="../continuousintegration/">Continuous integration</a></li><li><a class="tocitem" href="../setting_reference/">Setting reference exp</a></li><li><a class="tocitem" href="../internalorganization/">Internal organization</a></li></ul></li><li><span class="tocitem">HPC Platforms</span><ul><li><a class="tocitem" href="../belenos/">Belenos</a></li><li><a class="tocitem" href="../atos_bologna/">Atos</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Appendix</a></li><li class="is-active"><a href>Versioning tests</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Versioning tests</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ACCORD-NWP/DAVAI-env" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ACCORD-NWP/DAVAI-env/blob/master/docs/src/versioningtest.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Versioning-of-tests"><a class="docs-heading-anchor" href="#Versioning-of-tests">Versioning of tests</a><a id="Versioning-of-tests-1"></a><a class="docs-heading-anchor-permalink" href="#Versioning-of-tests" title="Permalink"></a></h2><p>The following reasons may require to update the tests:</p><ol><li><p>Update the input resources or a task template script, to <strong>change the purpose or context of a test</strong> (e.g. new observations or  modified namelists, to pull the tests more closely to operational configurations, ...). This usually comes with a change in the targeted tests outputs.</p></li><li><p>Add <strong>new tests</strong>.</p></li><li><p>Update the resources to <strong>adapt to a code change</strong> (e.g. new radiative coefficients files format, or a mandatory namelist change), with or without change in the results.</p></li></ol><p>Therefore it is necessary to track the evolutions of the tests properly, and version them clearly, so that it is clear what fixed or evolving version is to be used in any context. Hence the existence of the <code>DAVAI-tests</code> repository. The first two kinds of evolutions (a. and b.) are not necessarily linked to a contribution of code to the IAL repository, and therefore can be implemented at any moment in a dedicated branch of the tests repository (<code>DAVAI-tests</code>). This is described in more details in section <a href="#add-modify-tests">add-modify-tests</a></p><p>The latter is on the other hand attached to a contribution, and will require to be given together with the contribution for an integration, and be integrated itself in an evolving tests branch dedicated to test successive steps of the IAL integration branch. This case is detailed in more details in section <a href="#parallel-branches">parallel-branches</a> </p><p>To follow more easily what version of the tests should be used in particular for contributions to the IAL codes, it is proposed to adopt a nomenclature that maps the IAL releases and integration/merge branches, but replacing <code>&quot;CY&quot;</code> by <code>&quot;DV&quot;</code> (for DAVAÏ), as illustrated </p><p><img src="../assets/tests_versioning.png" alt/></p><p>With this principle, the version of the tests to be used <em>by default</em> would be, for example:</p><ul><li><p>for a development based on <code>CY49</code> <span>$\rightarrow$</span> <code>DV49</code></p></li><li><p>for an integration branch towards <code>CY49T1</code>, named <code>dev_CY49_to_T1</code> <span>$\rightarrow$</span> <code>dev_DV49_to_T1</code></p></li></ul><h3 id="add-modify-tests"><a class="docs-heading-anchor" href="#add-modify-tests">Adding or updating tests independently from the code</a><a id="add-modify-tests-1"></a><a class="docs-heading-anchor-permalink" href="#add-modify-tests" title="Permalink"></a></h3><p>The tests modifications which are not intrinsically linked with a contribution (adding tests or modifying a test to modify its behaviour) can be done at any moment, in a development branch of the tests repository. However, in order not to disturb the users and integrators, they should be merged into the next official version of tests (i.e. the version used for contributions and integrations to IAL) [only between a declaration of an IAL release and a call for contribution]{.underline}.</p><h3 id="parallel-branches"><a class="docs-heading-anchor" href="#parallel-branches">Evolution of the tests w.r.t. Integration of an IAL release</a><a id="parallel-branches-1"></a><a class="docs-heading-anchor-permalink" href="#parallel-branches" title="Permalink"></a></h3><p>In the context of integration of an IAL release, it is suitable that the tests change as little as possible during the successive integration of contributions. Therefore we will set a version of the tests at the beginning of integration, and only adapt it for the contributions that require an update of the tests.<br/>Let&#39;s consider the process of integration of contribution branches on top of <code>CY49</code> to build a <code>CY49T1</code>. For that purpose we would have set a reference experiment on <code>CY49</code>, hereafter named <code>x0</code>, generated with an identified version of the tests. That version of the tests would then be updated with <code>x0</code> as <em>reference experiment</em> (<code>ref_xpid</code>), and tagged <code>DV49</code>. All contributions to <code>CY49T1</code> would then be required to be tested with this version <code>DV49</code> (hence against reference experiment <code>x0</code>). Cf. section <a href="../setting_reference/#set_ref_version">set a ref tests version</a> for more details about setting up a reference tests version and experiment.</p><p>Suppose then that we have 5 of these contribution branches based on <code>CY49</code>, and an integration branch named <code>dev_CY49_toT1</code>. These 4 contributions may have different levels of reproducibility: they may conserve the results or not; they may require resources/tests adaptations (e.g. namelist updates, ...) or not, in which case they come with tests adaptations in an associated tests branch. Cf. the table</p><table><tr><th style="text-align: left">branch</th><th style="text-align: left">results</th><th style="text-align: left">test XPID</th><th style="text-align: left">resources</th><th style="text-align: left">tested with</th><th style="text-align: left">integration XPID</th></tr><tr><td style="text-align: left"><code>b1</code></td><td style="text-align: left"><span>$=$</span></td><td style="text-align: left"><code>x1</code></td><td style="text-align: left"><span>$=$</span></td><td style="text-align: left"><code>DV49</code></td><td style="text-align: left"><code>xi1</code></td></tr><tr><td style="text-align: left"><code>b2</code></td><td style="text-align: left"><span>$\neq$</span></td><td style="text-align: left"><code>x2</code></td><td style="text-align: left"><span>$=$</span></td><td style="text-align: left"><code>DV49</code></td><td style="text-align: left"><code>xi2</code></td></tr><tr><td style="text-align: left"><code>b3</code></td><td style="text-align: left"><span>$=$</span></td><td style="text-align: left"><code>x3</code></td><td style="text-align: left"><span>$\neq$</span></td><td style="text-align: left"><span>$\rightarrow$</span> <code>DV49_b3</code></td><td style="text-align: left"><code>xi3</code></td></tr><tr><td style="text-align: left"><code>b4</code></td><td style="text-align: left"><span>$\neq$</span></td><td style="text-align: left"><code>x4</code></td><td style="text-align: left"><span>$\neq$</span></td><td style="text-align: left"><span>$\rightarrow$</span> <code>DV49_b4</code></td><td style="text-align: left"><code>xi4</code></td></tr></table><p>In parallel to the integration branch <code>dev_CY49_toT1</code>, we start a tests branch from <code>DV49</code> to collect the necessary adaptations of the tests, similarly named <code>dev_DV49_toT1</code>, which will be used to validate the integration branch, and updated as required along the integration.</p><p>In case some intermediate versions of the integration branch are tagged and some branches are based/rebased on these tagged versions, we could also tag accordingly the tests branch if necessary.  The reference experiment for the integration branch is at any moment, <em>by default</em>, the experiment which tested the formerly integrated branch, e.g. the reference for <code>xi2</code> is <code>xi1</code>. However, that may not be true in some cases, some of these being potentially more tricky to validate, as will be shown in the following example.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../exercise4developers/">« Exercises</a><a class="docs-footer-nextpage" href="../continuousintegration/">Continuous integration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Thursday 27 June 2024 12:46">Thursday 27 June 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
